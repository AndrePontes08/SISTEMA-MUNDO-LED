{% extends "base.html" %}
{% block title %}Contas - Dashboard{% endblock %}
{% block page_title %}Contas a Pagar{% endblock %}
{% block content %}
<div class="grid" style="margin-bottom:12px;">
  <div class="tile"><div class="muted">Contas para pagar hoje</div><h2 style="margin:4px 0;">R$ {{ total_dia }}</h2><div class="muted">{{ contas_dia|length }} conta(s)</div></div>
  <div class="tile"><div class="muted">Total da semana (abertas)</div><h2 style="margin:4px 0;">R$ {{ total_semana }}</h2><div class="muted">{{ contas_semana|length }} conta(s)</div></div>
  <div class="tile"><div class="muted">Total do mês (abertas)</div><h2 style="margin:4px 0;">R$ {{ total_mes_abertas }}</h2><div class="muted">{{ contas_mes|length }} conta(s)</div></div>
</div>

<div class="card">
  <h2 style="margin-top:0;">Prioridade do dia</h2>
  <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;">
    <a class="btn" href="{% url 'contas:contas_periodo_pdf' 'dia' %}">Gerar PDF do dia</a>
    <a class="btn" href="{% url 'contas:contas_periodo_pdf' 'semana' %}">Gerar PDF da semana</a>
    <a class="btn" href="{% url 'contas:contas_periodo_pdf' 'mes' %}">Gerar PDF do mês</a>
  </div>

  <div class="table-responsive" style="margin-top:10px;">
    <table class="table table-hover">
      <thead><tr><th>Venc.</th><th>Descrição</th><th>Centro</th><th>Valor</th><th></th></tr></thead>
      <tbody>
      {% for c in contas_dia %}
        <tr>
          <td>{{ c.vencimento|date:"d/m/Y" }}</td>
          <td>{{ c.descricao }}</td>
          <td>{{ c.centro_custo }}</td>
          <td>R$ {{ c.valor }}</td>
          <td><a href="{% url 'contas:conta_detail' c.id %}">Abrir</a></td>
        </tr>
      {% empty %}
        <tr><td colspan="5" class="muted">Sem contas abertas vencendo hoje.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="card" style="margin-top:12px;">
  <h2 style="margin-top:0;">Resumo do mês (geral)</h2>
  <p class="muted">Abertas: {{ abertas_mes }} | Pagas: {{ pagas_mes }} | Total mês: R$ {{ total_mes }}</p>
  <p class="muted">Imposto ({{ imposto.regra_nome }}): percentual {{ imposto.percentual }} | estimado: R$ {{ imposto.imposto_estimado }}</p>
  <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;">
    <a class="btn" href="{% url 'contas:conta_create' %}">Nova conta</a>
    <a class="btn" href="{% url 'contas:import_csv' %}">Importar base (CSV)</a>
    <a class="btn btn-secondary" href="{% url 'contas:conta_list' %}">Ver lista</a>
  </div>
</div>

<div class="card" style="margin-top:12px;">
  <h3 style="margin-top:0;">Últimas contas</h3>
  <div class="table-responsive">
    <table class="table table-hover">
      <thead><tr><th>Venc.</th><th>Descrição</th><th>Centro</th><th>Valor</th><th>Status</th><th></th></tr></thead>
      <tbody>
      {% for c in ultimas %}
        <tr><td>{{ c.vencimento|date:"d/m/Y" }}</td><td>{{ c.descricao }}</td><td>{{ c.centro_custo }}</td><td>R$ {{ c.valor }}</td><td>{{ c.status }}</td><td><a href="{% url 'contas:conta_detail' c.id %}">Abrir</a></td></tr>
      {% empty %}<tr><td colspan="6" class="muted">Sem registros.</td></tr>{% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
