{% load static %}
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/jpeg" href="{% static 'core/img/logo.jpg' %}">
  <title>{% block title %}GESTOR AZUL{% endblock %}</title>
  <style>
    :root {
      --sidebar-bg: #0f172a;
      --sidebar-text: #e2e8f0;
      --sidebar-active: #1d4ed8;
      --page-bg: #f3f4f6;
      --card-bg: #ffffff;
    }
    html { font-size: 17px; }
    * { box-sizing: border-box; }
    body {
      margin:0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      font-size: 1rem;
      font-weight: 500;
      line-height: 1.45;
      background: var(--page-bg);
      color:#111827;
    }
    h1, h2, h3, h4 { margin: 0 0 8px 0; line-height: 1.2; font-weight: 700; }
    h1 { font-size: 1.8rem; }
    h2 { font-size: 1.35rem; }
    h3 { font-size: 1.15rem; }
    p, li, td, th, label, span, a, input, select, textarea, button { font-size: 1rem; }
    .layout { min-height: 100vh; }
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      width: 250px;
      background: linear-gradient(180deg, #0f172a 0%, #111827 100%);
      color: var(--sidebar-text);
      padding: 18px 14px;
      overflow-y: auto;
      z-index: 10;
    }
    .brand {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 96px;
      margin-bottom: 18px;
      border-radius: 12px;
      background: rgba(255,255,255,.04);
      padding: 12px;
      font-size: 26px;
      font-weight: 700;
      letter-spacing: .08em;
      text-align: center;
      color: var(--sidebar-text);
    }
    .menu-group { margin-bottom: 14px; }
    .menu-title { font-size: 11px; text-transform: uppercase; opacity: .65; margin: 10px 8px; letter-spacing: .06em; }
    .menu-accordion {
      margin-bottom: 8px;
      border-radius: 10px;
      background: rgba(255,255,255,.03);
      overflow: hidden;
    }
    .menu-accordion > summary {
      list-style: none;
      cursor: pointer;
      padding: 10px 12px;
      color: var(--sidebar-text);
      font-size: 0.96rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: space-between;
      user-select: none;
    }
    .menu-accordion > summary::-webkit-details-marker { display: none; }
    .menu-accordion > summary:hover { background: rgba(255,255,255,.08); }
    .menu-accordion[open] > summary { background: rgba(255,255,255,.1); }
    .menu-children { padding: 6px 8px 8px 8px; }
    .menu-link {
      display: block;
      color: var(--sidebar-text);
      text-decoration: none;
      padding: 10px 12px;
      border-radius: 10px;
      margin-bottom: 6px;
      font-size: 0.96rem;
      font-weight: 600;
      transition: background .2s ease;
    }
    .menu-link:hover { background: rgba(255,255,255,.08); }
    .menu-link.active { background: var(--sidebar-active); }
    .content {
      margin-left: 250px;
      min-height: 100vh;
      padding: 18px 22px;
    }
    .topbar {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 12px 16px;
      box-shadow: 0 1px 8px rgba(15, 23, 42, .08);
      margin-bottom: 14px;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
    }
    table { font-size: 0.96rem; }
    th, td { vertical-align: top; }
    input, select, textarea {
      width: 100%;
      border: 1px solid #cbd5e1;
      border-radius: 10px;
      padding: 10px 12px;
      min-height: 42px;
      background: #fff;
      color: #0f172a;
      font-weight: 600;
    }
    textarea { min-height: 92px; }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #1d4ed8;
      box-shadow: 0 0 0 3px rgba(29, 78, 216, .15);
    }
    .messages { margin-bottom: 10px; }
    .msg { padding: 10px 12px; border-radius: 8px; margin-bottom: 8px; font-size: 13px; }
    .msg.success { background: #dcfce7; color:#166534; }
    .msg.error { background: #fee2e2; color:#991b1b; }
    .msg.info { background: #dbeafe; color:#1e3a8a; }
    .msg.warning { background: #fef3c7; color:#92400e; }
    .card { background:#fff; border-radius:12px; padding:16px; box-shadow:0 1px 10px rgba(0,0,0,0.06); }
    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:12px; margin-top:12px; }
    .tile { background:#f3f4f6; border-radius:12px; padding:14px; }
    .muted { color:#6b7280; font-size:0.94rem; font-weight: 600; }
    .btn {
      display:inline-block;
      padding:10px 14px;
      border-radius:10px;
      border: none;
      background:#111827;
      color:#fff;
      font-weight: 700;
      text-decoration:none;
      cursor: pointer;
    }
    .btn:hover { filter: brightness(1.06); }
    @media (max-width: 980px) {
      .sidebar { position: static; width: 100%; height: auto; }
      .content { margin-left: 0; }
    }
  </style>
  {% block extra_head %}{% endblock %}
</head>
<body>
<div class="layout">
  <aside class="sidebar">
    <div class="brand">GESTOR AZUL</div>
    <div class="menu-group">
      <div class="menu-title">Geral</div>
      <a class="menu-link" href="/">Painel Inicial</a>
      <a class="menu-link" href="/relatorios/">Relatorios</a>
    </div>
    <div class="menu-group">
      <div class="menu-title">Operacoes</div>
      <details class="menu-accordion" data-accordion-key="compras">
        <summary>Compras</summary>
        <div class="menu-children">
          <a class="menu-link" href="/compras/">Lista de compras</a>
          <a class="menu-link" href="/compras/aprovacoes/">Aprovacao de compras</a>
          <a class="menu-link" href="/compras/novo/">Nova compra</a>
        </div>
      </details>
      <details class="menu-accordion" data-accordion-key="estoque">
        <summary>Estoque</summary>
        <div class="menu-children">
          <a class="menu-link" href="/estoque/">Dashboard de estoque</a>
          <a class="menu-link" href="/estoque/recebimentos/">Recebimento de mercadorias</a>
          <a class="menu-link" href="/estoque/movimentos/novo/">Movimentos de estoque</a>
          <a class="menu-link" href="/estoque/transferencias/nova/">Transferencias entre lojas</a>
        </div>
      </details>
      <details class="menu-accordion" data-accordion-key="vendas">
        <summary>Vendas</summary>
        <div class="menu-children">
          <a class="menu-link" href="/vendas/">Lista de vendas</a>
          <a class="menu-link" href="/vendas/nova/">Nova venda/orcamento</a>
          <a class="menu-link" href="/vendas/dashboard/">Dashboard de vendas</a>
        </div>
      </details>
      <details class="menu-accordion" data-accordion-key="financeiro">
        <summary>Financeiro</summary>
        <div class="menu-children">
          <a class="menu-link" href="/contas/">Contas a pagar</a>
          <a class="menu-link" href="/financeiro/">Financeiro</a>
          <a class="menu-link" href="/boletos/">Boletos</a>
        </div>
      </details>
      <details class="menu-accordion" data-accordion-key="importadores">
        <summary>Importadores</summary>
        <div class="menu-children">
          <a class="menu-link" href="/importadores/caixa/importar/">Importar Caixa PDF</a>
          <a class="menu-link" href="/importadores/caixa/importacoes/">Historico de importacao</a>
        </div>
      </details>
    </div>
    <div class="menu-group">
      <div class="menu-title">Sistema</div>
      <a class="menu-link" href="/documentacao/">Documentacao</a>
      <a class="menu-link" href="/admin/">Admin</a>
      <a class="menu-link" href="/accounts/logout/">Sair</a>
    </div>
  </aside>

  <main class="content">
    <div class="topbar">
      <strong>{% block page_title %}GESTOR AZUL{% endblock %}</strong>
      <span class="muted">Usuario: {% if request.user.is_authenticated %}{{ request.user.username }}{% else %}-{% endif %}</span>
    </div>

    {% if messages %}
      <div class="messages">
        {% for message in messages %}
          <div class="msg {{ message.tags|default:'info' }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    {% block content %}
    <div class="card">
      <h2>PAINEL INICIAL</h2>
      <div class="grid">
        <div class="tile">
          <h3>Compras</h3>
          <p class="muted">Compras, itens, garantias, anexos.</p>
          <a class="btn" href="/compras/">Abrir</a>
        </div>
        <div class="tile">
          <h3>Estoque</h3>
          <p class="muted">Movimentos, transferencias e alertas.</p>
          <a class="btn" href="/estoque/">Abrir</a>
        </div>
        <div class="tile">
          <h3>Contas a pagar</h3>
          <p class="muted">Comprovantes, projecao e impostos.</p>
          <a class="btn" href="/contas/">Abrir</a>
        </div>
        <div class="tile">
          <h3>Boletos</h3>
          <p class="muted">Vendedores, anexos, lista negra e fiado.</p>
          <a class="btn" href="/boletos/">Abrir</a>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:12px;">
      <h2>RESULTADO DO DIA</h2>
      {% with rd=resultado_diario_dashboard %}
        {% if rd and rd.data_referencia %}
          <p class="muted">Base de calculo em {{ rd.data_referencia|date:"d/m/Y" }} (ou ultima data disponivel).</p>
          <table style="width:100%;border-collapse:collapse;margin-top:10px;">
            <thead>
              <tr>
                <th style="text-align:left;padding:8px;border-bottom:1px solid #e5e7eb;">Unidade</th>
                <th style="text-align:left;padding:8px;border-bottom:1px solid #e5e7eb;">Vendas PDF</th>
                <th style="text-align:left;padding:8px;border-bottom:1px solid #e5e7eb;">Saidas Financeiro</th>
                <th style="text-align:left;padding:8px;border-bottom:1px solid #e5e7eb;">Resultado Liquido</th>
              </tr>
            </thead>
            <tbody>
              {% for linha in rd.linhas %}
              <tr>
                <td style="padding:8px;border-bottom:1px solid #e5e7eb;">{{ linha.unidade }}</td>
                <td style="padding:8px;border-bottom:1px solid #e5e7eb;">R$ {{ linha.vendas }}</td>
                <td style="padding:8px;border-bottom:1px solid #e5e7eb;">R$ {{ linha.saidas }}</td>
                <td style="padding:8px;border-bottom:1px solid #e5e7eb;"><strong>R$ {{ linha.resultado }}</strong></td>
              </tr>
              {% endfor %}
            </tbody>
            <tfoot>
              <tr>
                <td style="padding:8px;"><strong>Consolidado</strong></td>
                <td style="padding:8px;"><strong>R$ {{ rd.total_vendas_geral }}</strong></td>
                <td style="padding:8px;"><strong>R$ {{ rd.total_saidas_geral }}</strong></td>
                <td style="padding:8px;"><strong>R$ {{ rd.resultado_geral }}</strong></td>
              </tr>
            </tfoot>
          </table>
        {% else %}
          <p class="muted">Sem PDF de caixa importado ainda. Use "Importar Caixa PDF" no menu.</p>
        {% endif %}
      {% endwith %}
    </div>
    {% endblock %}
  </main>
</div>
<script>
  (function () {
    var key = "erp_sidebar_accordion_state_v1";
    var accordions = Array.prototype.slice.call(document.querySelectorAll(".menu-accordion[data-accordion-key]"));
    if (!accordions.length) return;

    var state = {};
    try {
      state = JSON.parse(localStorage.getItem(key) || "{}");
    } catch (e) {
      state = {};
    }

    var pathname = window.location.pathname || "/";

    function inferOpenByPath(acc) {
      var links = acc.querySelectorAll("a.menu-link[href]");
      for (var i = 0; i < links.length; i++) {
        var href = links[i].getAttribute("href");
        if (!href) continue;
        if (pathname === href || (href !== "/" && pathname.indexOf(href) === 0)) {
          return true;
        }
      }
      return false;
    }

    accordions.forEach(function (acc) {
      var accKey = acc.getAttribute("data-accordion-key");
      var shouldOpen = Object.prototype.hasOwnProperty.call(state, accKey) ? !!state[accKey] : inferOpenByPath(acc);
      acc.open = shouldOpen;
      acc.addEventListener("toggle", function () {
        state[accKey] = acc.open;
        localStorage.setItem(key, JSON.stringify(state));
      });
    });
  })();
</script>
</body>
</html>



