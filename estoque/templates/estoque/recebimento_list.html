{% extends "base.html" %}

{% block title %}Estoque - Recebimento{% endblock %}
{% block page_title %}Recebimento de Mercadorias{% endblock %}

{% block content %}
<style>
  .card { background:#fff; border-radius:12px; padding:16px; box-shadow:0 1px 10px rgba(0,0,0,.06); }
  table { width:100%; border-collapse: collapse; margin-top:10px; }
  th, td { padding:10px; border-bottom:1px solid #e5e7eb; text-align:left; }
  .muted { color:#6b7280; font-size:13px; }
  .btn { display:inline-block; padding:8px 12px; border-radius:10px; background:#111827; color:#fff; text-decoration:none; border:none; cursor:pointer; }
  .status-chip { display:inline-block; font-size:12px; padding:3px 8px; border-radius:999px; font-weight:600; }
  .status-ok { background:#dcfce7; color:#166534; }
  .status-warn { background:#fef3c7; color:#92400e; }
  .status-low { background:#fee2e2; color:#991b1b; }
</style>

<div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;">
    <div>
      <h2 style="margin:0;">Compras aprovadas aguardando recebimento</h2>
      <div class="muted">Fluxo exclusivo do estoque para conferencia fisica e confirmacao de recebimento.</div>
    </div>
    <a class="btn" href="{% url 'estoque:dashboard' %}">Voltar ao dashboard</a>
  </div>

  <form method="get" style="display:flex;gap:8px;margin:12px 0;align-items:center;">
    <input type="text" name="q" placeholder="Buscar fornecedor" value="{{ request.GET.q }}" style="max-width:320px;">
    <button class="btn" type="submit">Filtrar</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Data</th>
        <th>Fornecedor</th>
        <th>Itens</th>
        <th>Total</th>
        <th>Anexos de orcamento</th>
        <th>Acao</th>
      </tr>
    </thead>
    <tbody>
      {% for compra in compras %}
      <tr>
        <td>#{{ compra.id }}</td>
        <td>{{ compra.data_compra|date:"d/m/Y" }}</td>
        <td>{{ compra.fornecedor.nome }}</td>
        <td>{{ compra.itens.count }}</td>
        <td>R$ {{ compra.valor_total }}</td>
        <td>
          {% if compra.orcamento_1 and compra.orcamento_2 and compra.orcamento_3 %}
            <span class="status-chip status-ok">3/3 anexos</span>
          {% elif compra.orcamento_1 and compra.orcamento_2 or compra.orcamento_1 and compra.orcamento_3 or compra.orcamento_2 and compra.orcamento_3 %}
            <span class="status-chip status-warn">2/3 anexos</span>
          {% elif compra.orcamento_1 or compra.orcamento_2 or compra.orcamento_3 %}
            <span class="status-chip status-low">1/3 anexo</span>
          {% else %}
            <span class="status-chip status-low">0/3 anexos</span>
          {% endif %}
        </td>
        <td><a class="btn" href="{% url 'estoque:recebimento_detail' compra.id %}">Conferir e Receber</a></td>
      </tr>
      {% empty %}
      <tr><td colspan="7" class="muted">Sem compras aprovadas pendentes de recebimento.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
