{% extends "base.html" %}
{% block title %}Importacao Caixa #{{ importacao.id }}{% endblock %}
{% block page_title %}Importacao Caixa #{{ importacao.id }}{% endblock %}
{% block content %}
<style>
  .card{background:#fff;border-radius:12px;padding:16px;box-shadow:0 1px 10px rgba(0,0,0,.06);margin-bottom:12px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid #e5e7eb;text-align:left}
  .kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
  .kpi{background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;padding:10px}
  .kpi .label{font-size:12px;color:#64748b;text-transform:uppercase}
  .kpi .value{font-size:20px;font-weight:700}
</style>

<div class="card">
  <p><strong>Data:</strong> {{ importacao.data_referencia|date:"d/m/Y" }}</p>
  <p><strong>Unidade:</strong> {{ importacao.get_unidade_display }}</p>
  <p><strong>Empresa:</strong> {{ importacao.empresa_nome|default:"-" }}</p>
  <p><strong>Total vendas:</strong> {{ importacao.total_vendas }}</p>
  <p><strong>Total trocas:</strong> {{ importacao.total_trocas }}</p>
  <p><strong>Status:</strong> {{ importacao.status }}</p>
  <p><strong>Itens:</strong> {{ importacao.itens_baixados }}/{{ importacao.itens_detectados }} (inconsistentes {{ importacao.itens_inconsistentes }})</p>
</div>

<div class="card">
  <h3>Vendas por forma de pagamento</h3>
  {% with d=importacao.vendas_detalhadas %}
    {% if d %}
      <div class="kpi-grid">
        <div class="kpi"><div class="label">Especie</div><div class="value">R$ {{ d.ESPECIE|default:"0.00" }}</div></div>
        <div class="kpi"><div class="label">Duplicata</div><div class="value">R$ {{ d.DUPLICATA|default:"0.00" }}</div></div>
        <div class="kpi"><div class="label">Boleto</div><div class="value">R$ {{ d.BOLETO|default:"0.00" }}</div></div>
        <div class="kpi"><div class="label">Cartao Credito</div><div class="value">R$ {{ d.CARTAO_CREDITO|default:"0.00" }}</div></div>
        <div class="kpi"><div class="label">Cartao Debito</div><div class="value">R$ {{ d.CARTAO_DEBITO|default:"0.00" }}</div></div>
        <div class="kpi"><div class="label">Pix</div><div class="value">R$ {{ d.PIX|default:"0.00" }}</div></div>
        <div class="kpi"><div class="label">Pix Off</div><div class="value">R$ {{ d.PIX_OFF|default:"0.00" }}</div></div>
        <div class="kpi"><div class="label">Total</div><div class="value">R$ {{ d.TOTAL|default:importacao.total_vendas }}</div></div>
        <div class="kpi"><div class="label">Total Trocas</div><div class="value">R$ {{ d.TOTAL_TROCAS|default:importacao.total_trocas }}</div></div>
      </div>
    {% else %}
      <p>Sem detalhamento de formas de pagamento detectado no PDF.</p>
    {% endif %}
  {% endwith %}
</div>

<div class="card">
  <h3>Itens extraidos</h3>
  <table>
    <thead>
      <tr>
        <th>Codigo</th>
        <th>Descricao</th>
        <th>Quantidade</th>
        <th>Produto</th>
        <th>Baixado</th>
        <th>Mensagem</th>
      </tr>
    </thead>
    <tbody>
      {% for item in importacao.itens.all %}
      <tr>
        <td>{{ item.codigo_mercadoria }}</td>
        <td>{{ item.descricao }}</td>
        <td>{{ item.quantidade }}</td>
        <td>{{ item.produto|default:"-" }}</td>
        <td>{{ item.estoque_baixado|yesno:"Sim,Nao" }}</td>
        <td>{{ item.mensagem|default:"-" }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="6">Sem itens.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="card">
  <h3>Inconsistencias</h3>
  <ul>
    {% for inc in importacao.inconsistencias.all %}
      <li>{{ inc.codigo|default:"-" }} - {{ inc.descricao }} {% if inc.detalhes %}({{ inc.detalhes }}){% endif %}</li>
    {% empty %}
      <li>Sem inconsistencias.</li>
    {% endfor %}
  </ul>
</div>
{% endblock %}
